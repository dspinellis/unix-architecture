hbox {
  hl \bfseries{User Space}
  hbox {
    hl User commands
    hbox {
      hl [Shells]
      vl [color=SkyBlue] sh
      vl csh
      vl bash
      vl zsh
      vl tcsh
      vl ...
    }
    hbox [color=SkyBlue] {
      hl [Program Development]
      vl as
      vl cc
      vl ld
      vl nm
      vl ...
    }
    hbox {
      hl [File Management]
      vl [color=SkyBlue] ls
      vl [color=SkyBlue] cp
      vl [color=SkyBlue] cmp
      vl [color=SkyBlue] mkdir
      vl touch
      vl ...
    }
    hbox [color=SkyBlue] {
      hl [Multiuser Commands]
      vl login
      vl chown
      vl chmod
      vl su
      vl who
      vl ...
    }
    hbox {
      hl [Number Processing]
      vl dc
      vl bc
      vl units
      vl expr
    }

    hbox {
      hl [Text Processing]
      vl [color=SkyBlue] wc
      vl grep
      vl [color=SkyBlue] sort
      vl uniq
      vl ...
    }
    hbox {
      hl [User Messaging]
      vl [color=SkyBlue] mail
      vl [color=SkyBlue] mesg
      vl [color=SkyBlue] write
      vl talk
    }
    hbox {
      hl [Little Languages]
      vl sed
      vl awk
      vl m4
      vl ...
    }
    hbox {
      hl [Network clients]
        vl scp
        vl telnet
        vl ftp
        vl rcp
        vl ...
    }
    hbox {
      hl [Document Preparation]
        vl [color=SkyBlue] *roff
        vl eqn
        vl tbl
        vl refer
        vl ...
    }
    hbox ...
  }
  hbox {
    hl Administrator and System Commands
    hbox {
      hl [Filesystem Management]
      vl fsck
      vl newfs
      vl gpart
      vl [color=Bisque] mount
      vl [color=Bisque] umount
      vl ...
    }
    hbox {
      hl [Networking]
      vl ifconfig
      vl route
      vl arp
      vl ...
    }
    hbox {
      hl [User Management]
      vl adduser
      vl vipw
      vl sa
      vl quota*
      vl ...
    }
    hbox {
      hl [Statistics]
      vl iostat
      vl vmstat
      vl pstat
      vl ...
    }

    hbox {
      hl [Network Servers]
      vl sshd
      vl ftpd
      vl ntpd
      vl sendmail
      vl routed
      vl rpc.*
      vl ...
    }
    hbox {
      hl [Scheduling]
      vl cron
      vl periodic
      vl rc.*
      vl atrun
    }
    hbox ...
  }

  hbox {
    hl [adornlr=upspoon] Libraries
    hbox {
      hl [C Standard]
      vl ctype
      vl [color=LightGreen] math
      vl [color=LightGreen] stdio
      vl [color=LightGreen] stdlib
      vl string
      vl [color=LightGreen] time
      vl ...
    }
    hbox {
      hl [Operating System]
      vl fcntl
      vl unistd
      vl socket
      vl paths
      vl getopt
      vl err
      vl ...
    }
    hbox {
      hl [Peripheral Access]
      vl curses
      vl termcap
      vl tcgetattr
      vl usbhid
      vl nandfs
      vl cam
      vl geom
      vl ...
    }
    hbox {
      hl [System File Access]
      vl getlogin
      vl getgrent
      vl getprotoent
      vl getservent
      vl ...
    }
    hbox {
      hl [Data Handling]
      vl dbm
      vl dbopen
      vl btree
      vl hash
      vl recno
      vl mpool
      vl queue
    }
    hbox { # find . -name Makefile | xargs grep -w LIBADD | awk '{$1 = "" ; print }' | tr -c a-z \\n | sort | uniq -c | sort -rn | more
      hl [Security]
      vl ssl
      vl krb
      vl crypto
      vl crypt
      vl n ...
    }
    hbox {
      hl [Internationalization]
      vl catopen
      vl localeconv
      vl iconv
      vl mb*
      vl ...
    }
    hbox {
      hl [Threads]
      vl stdthreads
      vl thr
      vl pthread
    }
    hbox ...
  }
}

hbox { # Based on M. Bach. The Design of the Unix OS, Figure 2.1
  hl [adornlr=upspoon] \bfseries{Kernel Space}
  hbox {
    hl [adornlr=upspoon] System Call Interface
    vl [color=LightPink] [File management]
    vl [color=LightPink] [File I/O]
    vl [color=LightPink] [Mountable filesystems]
    vl [File access control (ACL)]
    vl [color=LightPink] [File permissions]
    vl [color=LightPink] [Process]
    vl [Process tracing]
    vl [IPC]
    vl [Memory mapping]
    vl [Shared memory]
    vl [Semaphores]
    vl [Scheduling control]
    vl [Asynchronous I/O]
    vl [Kernel events]
    vl [KSE]
    vl [Memory locking]
    vl [File pointer I/O]
    vl [Per-process timers]
    vl [Message queues]
    vl [Message passing]
    vl [Process descriptors]
    vl [Extended file attributes]
    vl [Error message management]
    vl [Real time message queues]
    vl [Capsicum]
    vl [Feed-forward system clock]
    vl [Auditing (BSM)]
    vl [User groups]
    vl [Multiplexed file I/O]
    vl [Kernel modules]
    vl [Jails]
  }
  hbox {
    hl [Bootstrapping]
    vl [color=Khaki] Loaders
    vl Configuration
    vl Kernel modules
  }

  pbox {
    hbox { # Based on McKusick and Neville-Neil. The Design and Implementation of the FreeBSD OS, Figure 6.1
      hl [adornlr=upspoon] [I/O Subsystem]
      hbox {
	hl [adornlr=upspoon] [Vnode, ZFS, Object, active file entries, and VM Interfaces]
	pbox { # Special devices, named, and sockets
	  hbox [color=LightSkyBlue] {
	    hl [adornlr=upspoon] Special Devices
	    vl Line discipline
	    vl tty
	    vl Raw character
	    vl Raw disk
	  }
	  pbox {
	    hbox [adornlr=upspoon] [VM]
	    hbox { # See http://kos.enix.org/pub/vfssun.pdf#page=2
	      hl [adornlr=upspoon] VNODE / VFS
	      vl FFS
	      vl NFS
	      vl CD9660
	      vl Ext2FS
	      vl SMBFS
	      vl FuseFS
	      vl mfs
	      vl UDF
	      vl devfs
	      vl procfs
	      vl ...
	    }

	    hbox [adornlr=upspoon] [Buffer/page cache]
	  }
	  hbox {
	    hl [adornlr=upspoon] ZFS

	    hbox [adornlr=upspoon] ZPL

	    hbox [adornlr=upspoon] DMU

	    hbox [adornlr=upspoon] SPA
	  }
	  pbox {
	    hbox [adornlr=upspoon] Socket

	    hbox {
	      hl [adornlr=upspoon] [Network Protocols]
	      vl TCP
	      vl UDP
	      vl ICMP 4/6
	      vl IPSec
	      vl IP 4/6
	    }

	    hbox { # See http://www.netbsd.org/gallery/presentations/ast/2012_AsiaBSDCon/Tutorial_NETGRAPH.pdf#page=19
	      hl [adornlr=upspoon] NETGRAPH
	      vl ng\_async
	      vl ng\_atm
	      vl ng\_bpf
	      vl ... (50+)
	      vl ng\_vlan
	    }
	  }
	}
      }

      hbox {
	hl [adornlr=upspoon] Device Drivers and Abstractions
	hbox {
	  hl [adornlr=upspoon] Character Devices
	  vl [color=LightSkyBlue] Keyboard
	  vl Mouse
	  vl [color=LightSkyBlue] Printer
	  vl Tape
	  vl ...
	}
	hbox { # See http://www.win.tue.nl/~aeb/linux/lk/talks/lk-geom.pdf
	  hl [adornlr=upspoon] Disk I/O (GEOM)
	  hbox {
	    hl [adornlr=upspoon] Storage
	    vl stripe
	    vl mirror
	    vl raid3
	    vl raid5
	    vl concat
	    vl ...
	  }

	  hbox {
	    hl [adornlr=upspoon] Encryption/Compression
	    vl eli
	    vl bde
	    vl shsec
	    vl uzip
	  }

	  hbox {
	    hl [adornlr=upspoon] Filesystem
	    vl label
	    vl journal
	    vl cache
	    vl mbr
	    vl bsd
	  }

	  hbox {
	    hl [adornlr=upspoon] Virtualization
	    vl md
	    vl nop
	    vl gate
	    vl virstor
	    vl ...
	  }

	  hbox [adornlr=upspoon] ...
	}
	hbox { # See https://people.freebsd.org/~mav/disk.pdf#page=19
	  hl [adornlr=upspoon] Common Access (CAM)

	  hbox {
	    hl [adornlr=upspoon] Peripheral
	    vl disk
	    vl cdrom
	    vl tape
	    vl enclosure
	    vl changer
	    vl ...
	  }

	  hbox {
	    hl [adornlr=upspoon] Transport (XPT)
	  }

	  hbox {
	    hl [adornlr=upspoon] HBA
	    vl SAS
	    vl SPI
	    vl 1394
	    vl FC
	    vl UMASS
	    vl iSCSI
	    vl ...
	  }
	}
	hbox {
	  hl [adornlr=upspoon] Network Interface Drivers
	  hbox {
	    hl [adornlr=upspoon] [802.11 layer]
	    hl [adornlr=upspoon] [802.11 drivers]
	  }
	  hbox {
	    hl [adornlr=upspoon] [Native drivers]
	    vl if\_ae
	    vl if\_age
	    vl ... (100+)
	    vl if\_xl
	  }
	  hbox {
	    hl [adornlr=upspoon] NDIS wrapper
	    hl [adornlr=upspoon] NDIS drivers
	  }
	  }
	}
      }
    }
    hbox {
      hl [adornlr=upspoon] [Process Control Subsystem]
      vl [color=Khaki] [Scheduler]
      vl [color=Khaki] [Memory management]
      vl Inter-process [communication]
      vl [Debugging support]
      vl ...
    }
  vbox {
    hl [adornlr=upspoon] Kernel Utility Functions
    hbox {
      hl [Generic]
      vl ...
      vl bitset
      vl mbuf\_tags
      vl socket
      vl osd
      vl nvlist
      vl [color=Plum] namei
    }
    hbox {
      hl [Memory Management]
      vl ...
      vl malloc/free
      vl mbuf
      vl sbuf
      vl mbchain
      vl pbuf
      vl uma
      vl vmem
    }
    hbox {
      hl [Multitasking]
      vl ...
      vl ithread
      vl kthread
      vl swi
      vl taskque
      vl kproc
    }
    hbox {
      hl [Privilige Mgmt]
      vl ...
      vl priv
      vl mac
      vl acl
    }

    hbox {
      hl [Operations]
      vl ...
      vl ktr
      vl alq
      vl stack
      vl watchdog
      vl dtrace
      vl sysctl
      vl [color=Plum] panic
    }
    hbox {
      hl [Synchronization]
      vl ...
      vl signal
      vl atomic\_*
      vl condvar\_*
      vl critical\_*
      vl mutex
      vl sema
      vl sx
      vl *lock
      vl [color=Plum] wakeup
    }
    hbox {
      hl [Virtualization]
      vl ...
      vl driver
      vl devclass
      vl device
      vl rman
      vl crypto
      vl usb*
      vl cpuset
    }
  }

    hbox [adornlr=upspoon] \rule{51em}{0pt}[Bus Virtualizations]\rule{51em}{0pt}

    hbox [adornlr=upspoon] \rule{46.5em}{0pt}[Hardware and Architecture Abstractions]\rule{46.5em}{0pt}
  }
}
